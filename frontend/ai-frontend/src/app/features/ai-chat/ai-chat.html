<div class="ai-chat-wrapper">
  <div class="chat-panel">
    <div class="messages" #messagesContainer>
      <ng-container *ngFor="let msg of messages">
        <div class="bubble" [ngClass]="{
          'user': msg.sender === 'user',
          'ai': msg.sender === 'ai'
        }">
          <div *ngIf="msg.text" class="text">{{ msg.text }}</div>

          <table *ngIf="msg.table" class="result-table">
            <thead>
              <tr>
                <th *ngFor="let col of msg.table.columns">{{ col }}</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let row of msg.table.rows">
                <td *ngFor="let col of msg.table.columns">{{ row[col] }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </ng-container>

      <div class="bubble ai typing" *ngIf="typingText">{{ typingText }}</div>

      <div class="bubble ai typing-dots" *ngIf="loading && !typingText">
        <span class="dot"></span><span class="dot"></span><span class="dot"></span>
      </div>
    </div>

    <div class="input-row">
      <input [(ngModel)]="question" (keyup.enter)="send()" placeholder="Zeptej se na prodeje, trendy, produkty..." />

      <button class="mic-btn" [class.recording]="isRecording" [class.countdown]="countdownActive" (click)="toggleRecording()">ðŸŽ¤</button>

      <button class="send-btn" (click)="send()">âž¤</button>
    </div>
  </div>

  <div class="graph-panel" *ngIf="activeChart">
    <apx-chart
      [series]="activeChart.series"
      [chart]="activeChart.chart"
      [xaxis]="activeChart.xaxis"
      [theme]="activeChart.theme"
      [colors]="activeChart.colors"
      [stroke]="activeChart.stroke">
    </apx-chart>
  </div>
</div>
