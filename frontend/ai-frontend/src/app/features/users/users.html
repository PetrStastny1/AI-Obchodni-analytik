<div class="users-page">

  <div class="page-header">
    <div>
      <h2>Správa uživatelů</h2>
      <p class="subtitle">Přehled účtů, rolí a stavu aktivace</p>
    </div>

    <button mat-flat-button color="primary" (click)="openCreateDialog()">
      <mat-icon>person_add</mat-icon>
      <span>Nový uživatel</span>
    </button>
  </div>

  <div class="table-wrapper">

    <table mat-table [dataSource]="users" class="glass-table">

      <!-- Avatar -->
      <ng-container matColumnDef="avatar">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let u">
          <div class="avatar-circle">
            {{ u.username ? (u.username[0] | uppercase) : '?' }}
          </div>
        </td>
      </ng-container>

      <!-- Username -->
      <ng-container matColumnDef="username">
        <th mat-header-cell *matHeaderCellDef>Uživatel</th>
        <td mat-cell *matCellDef="let u">
          <div class="user-main">
            <div class="user-name">{{ u.username }}</div>
            <div class="user-email" *ngIf="u.email">{{ u.email }}</div>
          </div>
        </td>
      </ng-container>

      <!-- Role -->
      <ng-container matColumnDef="role">
        <th mat-header-cell *matHeaderCellDef>Role</th>
        <td mat-cell *matCellDef="let u">
          <span class="role-chip" [class.admin]="u.isAdmin">
            {{ u.isAdmin ? 'Admin' : 'Uživatel' }}
          </span>
        </td>
      </ng-container>

      <!-- Status -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Stav</th>
        <td mat-cell *matCellDef="let u">
          <span class="status-chip" [class.active]="u.isActive" [class.inactive]="!u.isActive">
            {{ u.isActive ? 'Aktivní' : 'Deaktivovaný' }}
          </span>
        </td>
      </ng-container>

      <!-- Created -->
      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef>Vytvořen</th>
        <td mat-cell *matCellDef="let u">
          {{ u.createdAt | date:'d.M.y HH:mm' }}
        </td>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let u" class="actions-cell">

          <button mat-icon-button matTooltip="Přepnout roli" (click)="toggleRole(u)">
            <mat-icon>{{ u.isAdmin ? 'arrow_downward' : 'arrow_upward' }}</mat-icon>
          </button>

          <button mat-icon-button matTooltip="Aktivovat / deaktivovat" (click)="toggleActive(u)">
            <mat-icon>{{ u.isActive ? 'block' : 'check_circle' }}</mat-icon>
          </button>

          <button mat-icon-button matTooltip="Reset hesla" (click)="resetPassword(u)">
            <mat-icon>key</mat-icon>
          </button>

        </td>
      </ng-container>

      <!-- Render rows -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

    </table>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!loading && users.length === 0">
      <mat-icon>group_off</mat-icon>
      <p>Žádní uživatelé zatím nebyli vytvořeni.</p>
      <button mat-stroked-button color="primary" (click)="openCreateDialog()">
        Přidat prvního uživatele
      </button>
    </div>

    <!-- Loading -->
    <div class="loading-overlay" *ngIf="loading">
      <mat-progress-spinner mode="indeterminate" diameter="32"></mat-progress-spinner>
      <span>Načítám uživatele…</span>
    </div>

  </div>
</div>
