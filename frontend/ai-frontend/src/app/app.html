@if (isAuthenticated$()) {
  <mat-sidenav-container class="app-shell">
    <mat-sidenav #sidenav mode="side" opened class="app-sidenav">
      <div class="sidenav-header">
        <div class="logo-circle">AI</div>
        <div class="logo-text">AI Obchodn√≠ Analytik</div>
      </div>

      <nav class="sidenav-nav">
        <button mat-button class="nav-item" routerLink="/dashboard" routerLinkActive="active">
          <mat-icon>analytics</mat-icon>
          <span>Dashboard</span>
        </button>

        <button mat-button class="nav-item" routerLink="/sales" routerLinkActive="active">
          <mat-icon>table_chart</mat-icon>
          <span>Prodeje</span>
        </button>

        <button mat-button class="nav-item" routerLink="/import" routerLinkActive="active">
          <mat-icon>file_upload</mat-icon>
          <span>Import CSV</span>
        </button>

        <button mat-button class="nav-item" routerLink="/ai-chat" routerLinkActive="active">
          <mat-icon>smart_toy</mat-icon>
          <span>AI dotazy</span>
        </button>
      </nav>
    </mat-sidenav>

    <mat-sidenav-content class="app-content">
      <mat-toolbar class="app-toolbar">
        <button mat-icon-button class="mobile-menu" (click)="sidenav.toggle()">
          <mat-icon>menu</mat-icon>
        </button>

        <span class="app-title">AI Business Analytics</span>
        <span class="spacer"></span>

        <div class="toolbar-actions">
          <button mat-icon-button class="theme-toggle-btn" (click)="toggleDarkMode()">
            <mat-icon>{{ isDark() ? 'light_mode' : 'dark_mode' }}</mat-icon>
          </button>

          <button
            mat-icon-button
            class="user-menu-btn"
            [matMenuTriggerFor]="userMenu"
          >
            <mat-icon>account_circle</mat-icon>
          </button>
        </div>
      </mat-toolbar>

      <main class="app-main">
        <router-outlet></router-outlet>
      </main>
    </mat-sidenav-content>
  </mat-sidenav-container>

  <!-- üîΩ PROFILOV√â MENU ‚Äì OPRAVENO -->
  <mat-menu #userMenu="matMenu" panelClass="user-menu-panel">
    <div class="user-menu-header" mat-menu-item disabled>
      <div class="avatar-circle">{{ userInitials() }}</div>
      <div class="user-meta">
        <div class="user-name">{{ currentUser()?.username || 'Nezn√°m√Ω u≈æivatel' }}</div>
        <div class="user-role">{{ currentUser()?.isAdmin ? 'Admin' : 'U≈æivatel' }}</div>
      </div>
    </div>

    <button
      mat-menu-item
      *ngIf="currentUser()?.isAdmin"
      routerLink="/users"
    >
      <mat-icon>group</mat-icon>
      <span>Spr√°va u≈æivatel≈Ø</span>
    </button>

    <button mat-menu-item (click)="logout()">
      <mat-icon>logout</mat-icon>
      <span>Odhl√°sit se</span>
    </button>
  </mat-menu>
} @else {
  <router-outlet></router-outlet>
}
