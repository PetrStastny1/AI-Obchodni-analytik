@if (isAuthenticated$()) {
  <mat-sidenav-container class="app-shell">

    <!-- SIDEBAR -->
    <mat-sidenav #sidenav mode="side" opened class="app-sidenav">
      <div class="sidenav-header">
        <div class="logo-circle">AI</div>
        <div class="logo-text">Business Analytics</div>
      </div>

      <nav class="sidenav-nav">

        <button mat-button class="nav-item" routerLink="/dashboard" routerLinkActive="active">
          <mat-icon>home</mat-icon>
          <span>Dashboard</span>
        </button>

        <button mat-button class="nav-item" routerLink="/sales" routerLinkActive="active">
          <mat-icon>bar_chart</mat-icon>
          <span>Prodeje</span>
        </button>

        <button mat-button class="nav-item" routerLink="/import" routerLinkActive="active">
          <mat-icon>file_upload</mat-icon>
          <span>Import</span>
        </button>

        <button mat-button class="nav-item" routerLink="/ai-chat" routerLinkActive="active">
          <mat-icon>smart_toy</mat-icon>
          <span>AI Dotazy</span>
        </button>

      </nav>
    </mat-sidenav>

    <!-- MAIN -->
    <mat-sidenav-content class="app-content">

      <!-- TOP TOOLBAR -->
      <mat-toolbar class="app-toolbar">

        <button mat-icon-button class="mobile-menu" (click)="sidenav.toggle()">
          <mat-icon>menu</mat-icon>
        </button>

        <span class="spacer"></span>

        <!-- AVATAR MENU BUTTON -->
        <button mat-icon-button class="user-menu-btn" [matMenuTriggerFor]="userMenu">
          <mat-icon>account_circle</mat-icon>
        </button>

      </mat-toolbar>

      <main class="app-main">
        <router-outlet></router-outlet>
      </main>

    </mat-sidenav-content>
  </mat-sidenav-container>

  <!-- üîµ ROUNDED POPUP MENU -->
  <mat-menu #userMenu="matMenu" class="user-menu-panel" panelClass="user-menu-panel">

    <div class="user-menu-header" mat-menu-item disabled>
      <div class="avatar-circle" [ngClass]="currentUser()?.isAdmin ? 'avatar-admin' : 'avatar-user'">
        <mat-icon class="avatar-icon">
          {{ currentUser()?.isAdmin ? 'shield' : 'person' }}
        </mat-icon>
      </div>
      <div class="user-meta">
        <div class="user-name">{{ currentUser()?.username || 'U≈æivatel' }}</div>
      </div>
    </div>

    <mat-divider></mat-divider>

    <button mat-menu-item routerLink="/users" *ngIf="currentUser()?.isAdmin">
      <mat-icon>group</mat-icon>
      <span>Spr√°va u≈æivatel≈Ø</span>
    </button>

    <button mat-menu-item (click)="logout()">
      <mat-icon>logout</mat-icon>
      <span>Odhl√°sit se</span>
    </button>

  </mat-menu>

} @else {
  <router-outlet></router-outlet>
}
